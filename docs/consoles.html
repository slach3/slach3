<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Acompanhe as últimas notícias sobre consoles de videogame">
    <meta name="theme-color" content="#ffffff">
    
    <title>GameNews - Consoles</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    
    <script>
        if (localStorage.getItem('darkMode') === 'true' || 
            window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark-mode');
        }
    </script>
    
    <style>
        .consoles-container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
        }
        
        .consoles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .console-card {
            background-color: var(--bg-color-card);
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .console-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .console-card img {
            width: 100%;
            height: 160px;
            object-fit: cover;
        }
        
        .console-info {
            padding: 15px;
        }
        
        .console-info h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        
        .console-info p {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: var(--text-color-secondary);
        }
        
        /* Estilo para o filtro de consoles */
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .filter-button {
            background-color: var(--bg-color-card);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-button:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .filter-button.active {
            background-color: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="left-header">
                <h1>
                    <i class="fas fa-gamepad"></i>
                    GameNews
                </h1>
                <nav>
                    <a href="index.html"><i class="fas fa-layer-group"></i><span>Todas</span></a>
                    <a href="consoles.html" class="active"><i class="fas fa-tv"></i><span>Consoles</span></a>
                    <a href="jogos.html"><i class="fas fa-dice"></i><span>Jogos</span></a>
                </nav>
            </div>
            <div class="header-controls">
                <button id="darkModeToggle" aria-label="Alternar modo escuro">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </header>

    <main>
        <div class="consoles-container">
            <h2>Notícias de Consoles</h2>
            
            <div class="filter-buttons">
                <button class="filter-button active" data-filter="todos">Todos</button>
                <button class="filter-button" data-filter="nintendo">Nintendo</button>
                <button class="filter-button" data-filter="playstation">PlayStation</button>
                <button class="filter-button" data-filter="xbox">Xbox</button>
                <button class="filter-button" data-filter="outros">Outros</button>
            </div>
            
            <div id="noticias-consoles" class="noticias-consoles">
                <!-- Notícias de consoles serão inseridas via JavaScript -->
                <div class="skeleton-loading">
                    <div class="skeleton-card">
                        <div class="skeleton-img"></div>
                        <div class="skeleton-content">
                            <div class="skeleton-title"></div>
                            <div class="skeleton-text"></div>
                            <div class="skeleton-text"></div>
                        </div>
                    </div>
                    <div class="skeleton-card">
                        <div class="skeleton-img"></div>
                        <div class="skeleton-content">
                            <div class="skeleton-title"></div>
                            <div class="skeleton-text"></div>
                            <div class="skeleton-text"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 2025 GameNews</p>
            <button id="install-app" style="display: none;">Instalar App</button>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="noticias.js"></script>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Função para carregar apenas notícias relacionadas a consoles
            function carregarNoticiasConsoles() {
                const container = document.getElementById('noticias-consoles');
                
                // Mostrar estado de carregamento
                container.innerHTML = `
                    <div class="skeleton-loading">
                        <div class="skeleton-card">
                            <div class="skeleton-img"></div>
                            <div class="skeleton-content">
                                <div class="skeleton-title"></div>
                                <div class="skeleton-text"></div>
                                <div class="skeleton-text"></div>
                            </div>
                        </div>
                        <div class="skeleton-card">
                            <div class="skeleton-img"></div>
                            <div class="skeleton-content">
                                <div class="skeleton-title"></div>
                                <div class="skeleton-text"></div>
                                <div class="skeleton-text"></div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Verificar se as notícias estão disponíveis
                if (typeof noticias === 'undefined' || !noticias) {
                    console.error('Notícias não disponíveis');
                    exibirMensagemErro(container, 'Não foi possível carregar as notícias. Por favor, recarregue a página.');
                    return;
                }
                
                const noticiasConsoles = filtrarNoticiasConsoles(noticias);
                
                // Limpar o container e remover o loading
                container.innerHTML = '';
                
                if (noticiasConsoles.length === 0) {
                    const mensagem = document.createElement('div');
                    mensagem.className = 'mensagem-vazia';
                    mensagem.textContent = 'Nenhuma notícia sobre consoles encontrada.';
                    container.appendChild(mensagem);
                    return;
                }
                
                // Criar a grade de notícias
                const grid = document.createElement('div');
                grid.className = 'noticias-grid';
                container.appendChild(grid);
                
                // Adicionar as notícias
                noticiasConsoles.forEach(noticia => {
                    const card = criarCardNoticia(noticia);
                    grid.appendChild(card);
                });
            }
            
            // Função para exibir mensagem de erro
            function exibirMensagemErro(container, mensagem) {
                container.innerHTML = `
                    <div class="erro">
                        <p>${mensagem}</p>
                        <button onclick="window.location.reload()">Recarregar</button>
                    </div>
                `;
            }
            
            // Cache para resultados filtrados
            const cacheResultados = {};
            
            // Função para filtrar notícias relacionadas a consoles
            function filtrarNoticiasConsoles(todasNoticias, filtro = 'todos') {
                // Verificar se já temos os resultados em cache
                const cacheKey = `${filtro}_${JSON.stringify(todasNoticias).length}`;
                if (cacheResultados[cacheKey]) {
                    console.log(`Usando resultados em cache para filtro: ${filtro}`);
                    return cacheResultados[cacheKey];
                }
                
                // Palavras-chave expandidas para identificar notícias sobre consoles
                const keywords = {
                    todos: ['console', 'consoles', 'nintendo', 'switch', 'playstation', 'ps5', 'ps4', 'ps3', 'xbox', 
                           'series x', 'series s', 'one', 'steam deck', 'oculus', 'meta quest', 'vr', 'portal', 
                           'handheld', 'portable', 'portátil', 'dispositivo', 'hardware'],
                    nintendo: ['nintendo', 'switch', 'switch 2', 'switch oled', 'switch lite', 'wii', 'wiiu', '3ds', 
                              'mario', 'zelda', 'pokémon', 'pokemon', 'animal crossing', 'splatoon', 'kirby', 
                              'metroid', 'joy-con', 'joycon', 'miyamoto', 'amiibo', 'nintendo direct'],
                    playstation: ['playstation', 'ps5', 'ps5 pro', 'ps5 slim', 'ps4', 'ps4 pro', 'ps3', 'psp', 'ps vita', 
                                 'sony', 'psvr', 'psvr2', 'dualsense', 'dualshock', 'horizon', 'god of war', 
                                 'gran turismo', 'ghost of tsushima', 'playstation plus', 'playstation portal', 'state of play'],
                    xbox: ['xbox', 'series x', 'series s', 'one x', 'one s', 'microsoft', 'game pass', 'halo', 
                          'forza', 'gears', 'fable', 'starfield', 'gamepass', 'xcloud', 'cloud gaming', 'phil spencer', 'xbox showcase'],
                    outros: ['steam deck', 'rog ally', 'legion go', 'ayaneo', 'oculus', 'meta quest', 'pico', 'vr', 
                            'realidade virtual', 'handheld', 'portable', 'portátil', 'cloud gaming', 'streaming de jogos']
                };
                
                try {
                    // Validação de entrada
                    if (!Array.isArray(todasNoticias)) {
                        console.error('Erro: O parâmetro todasNoticias não é um array válido', todasNoticias);
                        return [];
                    }
                    
                    const resultados = todasNoticias.filter(noticia => {
                        // Verificar se a notícia é válida e tem um título
                        if (!noticia || !noticia.titulo) {
                            console.warn('Notícia inválida encontrada:', noticia);
                            return false;
                        }
                        
                        // Converter o conteúdo da notícia para minúsculas para comparação
                        const titulo = (noticia.titulo || '').toLowerCase();
                        const descricao = (noticia.descricao || '').toLowerCase();
                        const conteudoNoticia = `${titulo} ${descricao}`;
                        
                        // Para o filtro "todos", verificar qualquer palavra-chave de console
                        if (filtro === 'todos') {
                            // Verificar todas as categorias de palavras-chave
                            return Object.values(keywords).some(categoryKeywords => 
                                categoryKeywords.some(keyword => {
                                    // Verificar palavras exatas ou como parte de outras palavras
                                    const regex = new RegExp(`(\\b${keyword}\\b|${keyword})`, 'i');
                                    return regex.test(conteudoNoticia);
                                })
                            );
                        }
                        
                        // Para filtros específicos, verificar apenas as palavras-chave da categoria
                        if (!keywords[filtro]) {
                            console.error(`Filtro inválido: ${filtro}`);
                            return false;
                        }
                        
                        return keywords[filtro].some(keyword => {
                            // Verificar palavras exatas ou como parte de outras palavras
                            const regex = new RegExp(`(\\b${keyword}\\b|${keyword})`, 'i');
                            return regex.test(conteudoNoticia);
                        });
                    });
                    
                    // Armazenar em cache para uso futuro
                    cacheResultados[cacheKey] = resultados;
                    
                    return resultados;
                } catch (error) {
                    console.error('Erro ao filtrar notícias de consoles:', error);
                    return [];
                }
            }
            
            // Função para criar um card de notícia
            function criarCardNoticia(noticia) {
                const card = document.createElement('div');
                card.className = 'noticia-card';
                
                // Formatação da data
                let dataFormatada = '';
                if (noticia.timestamp) {
                    const data = new Date(noticia.timestamp);
                    dataFormatada = data.toLocaleDateString('pt-BR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                } else if (noticia.data) {
                    const data = new Date(noticia.data);
                    dataFormatada = data.toLocaleDateString('pt-BR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                }
                
                card.innerHTML = `
                    <div class="imagem-container">
                        <img src="${noticia.imagem || 'images/fallback.png'}" 
                             alt="${noticia.titulo}" 
                             onerror="this.src='images/fallback.png'">
                    </div>
                    <div class="noticia-info">
                        <h3>${noticia.titulo}</h3>
                        <p>${noticia.descricao}</p>
                        <div class="noticia-meta">
                            <span class="fonte">${noticia.fonte}</span>
                            ${dataFormatada ? `<span class="data">${dataFormatada}</span>` : ''}
                        </div>
                        <a href="${noticia.link}" class="ler-mais" target="_blank" rel="noopener">Ler mais</a>
                    </div>
                `;
                
                // Fazer com que o card inteiro seja clicável
                card.addEventListener('click', (e) => {
                    // Ignorar se o clique foi no botão "ler mais"
                    if (e.target.classList.contains('ler-mais')) return;
                    
                    window.open(noticia.link, '_blank', 'noopener');
                });
                
                return card;
            }
            
            // Configurar botões de filtro
            const botoesFiltro = document.querySelectorAll('.filter-button');
            botoesFiltro.forEach(botao => {
                // Adicionar atributos de acessibilidade
                botao.setAttribute('role', 'button');
                botao.setAttribute('aria-pressed', botao.classList.contains('active') ? 'true' : 'false');
                
                botao.addEventListener('click', function() {
                    // Mostrar estado de carregamento
                    const container = document.getElementById('noticias-consoles');
                    container.innerHTML = `
                        <div class="skeleton-loading">
                            <div class="skeleton-card">
                                <div class="skeleton-img"></div>
                                <div class="skeleton-content">
                                    <div class="skeleton-title"></div>
                                    <div class="skeleton-text"></div>
                                    <div class="skeleton-text"></div>
                                </div>
                            </div>
                            <div class="skeleton-card">
                                <div class="skeleton-img"></div>
                                <div class="skeleton-content">
                                    <div class="skeleton-title"></div>
                                    <div class="skeleton-text"></div>
                                    <div class="skeleton-text"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Remover classe ativa de todos os botões
                    botoesFiltro.forEach(b => {
                        b.classList.remove('active');
                        b.setAttribute('aria-pressed', 'false');
                    });
                    
                    // Adicionar classe ativa ao botão clicado
                    this.classList.add('active');
                    this.setAttribute('aria-pressed', 'true');
                    
                    // Filtrar notícias com base no filtro selecionado
                    const filtro = this.getAttribute('data-filter');
                    
                    // Usar setTimeout para permitir que a interface seja atualizada antes
                    // de realizar a filtragem, que pode ser intensiva em termos de processamento
                    setTimeout(() => {
                        try {
                            const noticiasFiltradas = filtrarNoticiasConsoles(noticias, filtro);
                            
                            // Atualizar a exibição
                            container.innerHTML = '';
                            
                            if (noticiasFiltradas.length === 0) {
                                const mensagem = document.createElement('div');
                                mensagem.className = 'mensagem-vazia';
                                mensagem.textContent = `Nenhuma notícia sobre ${filtro} encontrada.`;
                                container.appendChild(mensagem);
                                return;
                            }
                            
                            // Criar a grade de notícias
                            const grid = document.createElement('div');
                            grid.className = 'noticias-grid';
                            container.appendChild(grid);
                            
                            // Adicionar as notícias
                            noticiasFiltradas.forEach(noticia => {
                                const card = criarCardNoticia(noticia);
                                grid.appendChild(card);
                            });
                        } catch (error) {
                            console.error('Erro ao filtrar notícias:', error);
                            exibirMensagemErro(container, 'Ocorreu um erro ao filtrar as notícias. Por favor, tente novamente.');
                        }
                    }, 100);
                });
                
                // Adicionar suporte para teclado
                botao.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
            
            // Carregar notícias de consoles quando a página carregar
            carregarNoticiasConsoles();
        });
    </script>
</body>
</html>